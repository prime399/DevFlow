<Page x:Class="DevFlow.Presentation.MainPage"
      xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
      xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
      xmlns:utu="using:Uno.Toolkit.UI"
      xmlns:converters="using:DevFlow.Converters"
      NavigationCacheMode="Required"
      Background="{StaticResource AppBackgroundBrush}">

  <Page.Resources>
    <converters:HttpMethodToBrushConverter x:Key="HttpMethodToBrushConverter" />
    <x:String x:Key="HeaderAccept">Accept</x:String>
    <x:String x:Key="HeaderAcceptCharset">Accept-Charset</x:String>
    <x:String x:Key="HeaderAcceptEncoding">Accept-Encoding</x:String>
    <x:String x:Key="HeaderAcceptLanguage">Accept-Language</x:String>
    <x:String x:Key="HeaderAuthorization">Authorization</x:String>
    <x:String x:Key="HeaderCacheControl">Cache-Control</x:String>
    <x:String x:Key="HeaderContentType">Content-Type</x:String>
    <x:String x:Key="HeaderContentLength">Content-Length</x:String>
    <x:String x:Key="HeaderContentEncoding">Content-Encoding</x:String>
    <x:String x:Key="HeaderCookie">Cookie</x:String>
    <x:String x:Key="HeaderHost">Host</x:String>
    <x:String x:Key="HeaderOrigin">Origin</x:String>
    <x:String x:Key="HeaderReferer">Referer</x:String>
    <x:String x:Key="HeaderUserAgent">User-Agent</x:String>
    <x:String x:Key="HeaderXApiKey">X-Api-Key</x:String>
    <x:String x:Key="HeaderXRequestId">X-Request-ID</x:String>
    <x:String x:Key="HeaderXCorrelationId">X-Correlation-ID</x:String>
    <x:String x:Key="HeaderIfMatch">If-Match</x:String>
    <x:String x:Key="HeaderIfNoneMatch">If-None-Match</x:String>
    <x:String x:Key="HeaderIfModifiedSince">If-Modified-Since</x:String>
  </Page.Resources>

  <Grid utu:SafeArea.Insets="VisibleBounds"
        Background="{StaticResource AppBackgroundBrush}">
    <NavigationView PaneDisplayMode="Left"
                    IsBackButtonVisible="Collapsed"
                    IsPaneOpen="True"
                    OpenPaneLength="240"
                    CompactPaneLength="64"
                    IsSettingsVisible="False"
                    PaneTitle="DevFlow API Lab">
      <NavigationView.PaneToggleButtonStyle>
        <StaticResource ResourceKey="AnimatedPaneToggleButtonStyle" />
      </NavigationView.PaneToggleButtonStyle>
      <NavigationView.MenuItemContainerStyle>
        <StaticResource ResourceKey="AnimatedNavigationViewItemStyle" />
      </NavigationView.MenuItemContainerStyle>
      <NavigationView.MenuItems>
        <NavigationViewItem Content="REST"
                            IsSelected="True"
                            x:Uid="MainPage.Nav.Rest">
          <NavigationViewItem.Icon>
            <FontIcon Glyph="{StaticResource IconGlyphGlobe}" />
          </NavigationViewItem.Icon>
        </NavigationViewItem>
        <NavigationViewItem Content="GraphQL"
                            x:Uid="MainPage.Nav.GraphQL">
          <NavigationViewItem.Icon>
            <FontIcon Glyph="{StaticResource IconGlyphGraph}" />
          </NavigationViewItem.Icon>
        </NavigationViewItem>
        <NavigationViewItem Content="Realtime"
                            x:Uid="MainPage.Nav.Realtime">
          <NavigationViewItem.Icon>
            <FontIcon Glyph="{StaticResource IconGlyphRealtime}" />
          </NavigationViewItem.Icon>
        </NavigationViewItem>
        <NavigationViewItem Content="Settings"
                            x:Uid="MainPage.Nav.Settings">
          <NavigationViewItem.Icon>
            <FontIcon Glyph="{StaticResource IconGlyphSettings}" />
          </NavigationViewItem.Icon>
        </NavigationViewItem>
      </NavigationView.MenuItems>

      <NavigationView.Content>
        <Grid RowDefinitions="Auto,Auto,*,Auto">
          <!-- Request URL Bar -->
          <Border Grid.Row="0"
                  Background="{StaticResource RequestBarBackgroundBrush}"
                  BorderBrush="{StaticResource RequestBarBorderBrush}"
                  BorderThickness="0,0,0,1"
                  Padding="8">
            <Grid ColumnDefinitions="Auto,*,Auto,Auto">
              <!-- Method Selector -->
              <Border Grid.Column="0"
                      Background="{StaticResource MethodSelectorBgBrush}"
                      CornerRadius="6,0,0,6"
                      BorderBrush="{StaticResource RequestBarBorderBrush}"
                      BorderThickness="1,1,0,1"
                      Padding="4,0">
                <ComboBox ItemsSource="{Binding Methods}"
                          SelectedItem="{Binding SelectedMethod, Mode=TwoWay}"
                          Style="{StaticResource MethodComboBoxStyle}"
                          x:Uid="MainPage.ComboBox.Method">
                  <ComboBox.ItemTemplate>
                    <DataTemplate>
                      <TextBlock Text="{Binding}"
                                 Foreground="{Binding Converter={StaticResource HttpMethodToBrushConverter}}"
                                 FontFamily="{StaticResource AppFontFamilyBold}"
                                 FontWeight="Bold"
                                 FontSize="14" />
                    </DataTemplate>
                  </ComboBox.ItemTemplate>
                </ComboBox>
              </Border>

              <!-- URL Input -->
              <Border Grid.Column="1"
                      Background="{StaticResource InputBackgroundBrush}"
                      BorderBrush="{StaticResource RequestBarBorderBrush}"
                      BorderThickness="1"
                      CornerRadius="0">
                <Grid ColumnDefinitions="*,Auto">
                  <TextBox Grid.Column="0"
                           Text="{Binding RequestUrl, Mode=TwoWay}"
                           PlaceholderText="https://api.example.com/endpoint"
                           Style="{StaticResource UrlTextBoxStyle}"
                           x:Uid="MainPage.TextBox.Url" />
                  <ProgressRing Grid.Column="1"
                                Width="20"
                                Height="20"
                                Margin="8,0"
                                IsActive="{Binding IsSending}" />
                </Grid>
              </Border>

              <!-- Send Button -->
              <Button Grid.Column="2"
                      Content="Send"
                      Command="{Binding SendRequest}"
                      Style="{StaticResource SendButtonStyle}"
                      Margin="8,0,4,0"
                      x:Uid="MainPage.Button.Send" />

              <!-- Save Button -->
              <Button Grid.Column="3"
                      Style="{StaticResource SaveButtonStyle}"
                      Margin="4,0,0,0">
                <StackPanel Orientation="Horizontal" Spacing="6">
                  <FontIcon Glyph="{StaticResource IconGlyphSave}" FontSize="14" />
                  <TextBlock Text="Save" FontFamily="{StaticResource AppFontFamilyMedium}" />
                </StackPanel>
              </Button>
            </Grid>
          </Border>

          <!-- Tab Navigation Bar -->
          <Border Grid.Row="1"
                  Background="{StaticResource TabBarBackgroundBrush}"
                  BorderBrush="{StaticResource RequestBarBorderBrush}"
                  BorderThickness="0,0,0,1">
            <Grid ColumnDefinitions="*,Auto">
              <!-- Left Tabs -->
              <StackPanel Grid.Column="0"
                          Orientation="Horizontal">
                <Button x:Name="TabParameters"
                        Content="Parameters"
                        Tag="0"
                        Click="Tab_Click"
                        Style="{StaticResource RequestTabActiveStyle}"
                        x:Uid="MainPage.Tab.Parameters" />
                <Button x:Name="TabBody"
                        Content="Body"
                        Tag="1"
                        Click="Tab_Click"
                        Style="{StaticResource RequestTabStyle}"
                        x:Uid="MainPage.Tab.Body" />
                <Button x:Name="TabHeaders"
                        Content="Headers"
                        Tag="2"
                        Click="Tab_Click"
                        Style="{StaticResource RequestTabStyle}"
                        x:Uid="MainPage.Tab.Headers" />
                <Button x:Name="TabAuth"
                        Content="Authorization"
                        Tag="3"
                        Click="Tab_Click"
                        Style="{StaticResource RequestTabStyle}"
                        x:Uid="MainPage.Tab.Auth" />
                <Button x:Name="TabPreScript"
                        Content="Pre-request Script"
                        Tag="4"
                        Click="Tab_Click"
                        Style="{StaticResource RequestTabStyle}"
                        x:Uid="MainPage.Tab.PreScript" />
                <Button x:Name="TabPostScript"
                        Content="Post-request Script"
                        Tag="5"
                        Click="Tab_Click"
                        Style="{StaticResource RequestTabStyle}"
                        x:Uid="MainPage.Tab.PostScript" />
              </StackPanel>

              <!-- Right side - Variables link -->
              <StackPanel Grid.Column="1"
                          Orientation="Horizontal"
                          Margin="0,0,12,0">
                <Button Style="{StaticResource IconButtonStyle}">
                  <FontIcon Glyph="{StaticResource IconGlyphVariables}" FontSize="14" Foreground="{StaticResource TextSecondaryBrush}" />
                </Button>
                <TextBlock Text="Variables"
                           Foreground="{StaticResource TextSecondaryBrush}"
                           FontFamily="{StaticResource AppFontFamily}"
                           VerticalAlignment="Center"
                           FontSize="13"
                           Margin="4,0,0,0" />
              </StackPanel>
            </Grid>
          </Border>

          <!-- Content Area -->
          <Grid Grid.Row="2" Background="{StaticResource TabBarBackgroundBrush}">
            <!-- Parameters Tab Panel (Index 0) -->
            <ScrollViewer x:Name="ParametersPanel" Visibility="Visible">
              <Grid RowDefinitions="Auto,Auto,*" Padding="0">
                <!-- Query Parameters Section -->
                <Border Grid.Row="0"
                        Background="{StaticResource RequestBarBackgroundBrush}"
                        BorderBrush="{StaticResource RequestBarBorderBrush}"
                        BorderThickness="0,0,0,1"
                        Padding="16,12">
                  <Grid ColumnDefinitions="*,Auto">
                    <StackPanel Orientation="Horizontal" Spacing="12" VerticalAlignment="Center">
                      <TextBlock Text="Query Parameters"
                                 Foreground="{StaticResource TextSecondaryBrush}"
                                 FontFamily="{StaticResource AppFontFamilySemiBold}"
                                 FontSize="13"
                                 VerticalAlignment="Center" />
                      <Border Background="{StaticResource SurfaceVariantBrush}"
                              CornerRadius="10"
                              Padding="8,2">
                        <TextBlock Text="{Binding Parameters.Count}"
                                   Foreground="{StaticResource TextMutedBrush}"
                                   FontFamily="{StaticResource MonospaceFontFamily}"
                                   FontSize="11"
                                   VerticalAlignment="Center" />
                      </Border>
                    </StackPanel>
                    <StackPanel Grid.Column="1" Orientation="Horizontal" Spacing="4">
                      <Button Style="{StaticResource IconButtonStyle}"
                              Click="ClearAllParameters_Click"
                              ToolTipService.ToolTip="Clear all parameters">
                        <FontIcon Glyph="{StaticResource IconGlyphDelete}" FontSize="14" Foreground="{StaticResource TextMutedBrush}" />
                      </Button>
                      <Button Style="{StaticResource IconButtonStyle}"
                              Click="AddParameter_Click"
                              ToolTipService.ToolTip="Add parameter">
                        <FontIcon Glyph="{StaticResource IconGlyphAdd}" FontSize="14" Foreground="{StaticResource AccentPrimaryBrush}" />
                      </Button>
                    </StackPanel>
                  </Grid>
                </Border>

                <!-- Parameters Table Header -->
                <Border Grid.Row="1"
                        Background="{StaticResource TabBarBackgroundBrush}"
                        BorderBrush="{StaticResource RequestBarBorderBrush}"
                        BorderThickness="0,0,0,1"
                        Padding="0">
                  <Grid ColumnDefinitions="52,*,*,*,88">
                    <Border Grid.Column="0"
                            BorderBrush="{StaticResource RequestBarBorderBrush}"
                            BorderThickness="0,0,1,0"
                            Padding="0,10" />
                    <Border Grid.Column="1"
                            BorderBrush="{StaticResource RequestBarBorderBrush}"
                            BorderThickness="0,0,1,0"
                            Padding="16,10">
                      <TextBlock Text="Key"
                                 Foreground="{StaticResource TextMutedBrush}"
                                 FontFamily="{StaticResource AppFontFamilyMedium}"
                                 FontSize="12" />
                    </Border>
                    <Border Grid.Column="2"
                            BorderBrush="{StaticResource RequestBarBorderBrush}"
                            BorderThickness="0,0,1,0"
                            Padding="16,10">
                      <TextBlock Text="Value"
                                 Foreground="{StaticResource TextMutedBrush}"
                                 FontFamily="{StaticResource AppFontFamilyMedium}"
                                 FontSize="12" />
                    </Border>
                    <Border Grid.Column="3"
                            BorderBrush="{StaticResource RequestBarBorderBrush}"
                            BorderThickness="0,0,1,0"
                            Padding="16,10">
                      <TextBlock Text="Description"
                                 Foreground="{StaticResource TextMutedBrush}"
                                 FontFamily="{StaticResource AppFontFamilyMedium}"
                                 FontSize="12" />
                    </Border>
                    <Border Grid.Column="4"
                            Padding="8,10">
                      <TextBlock Text="Actions"
                                 Foreground="{StaticResource TextMutedBrush}"
                                 FontFamily="{StaticResource AppFontFamilyMedium}"
                                 FontSize="12"
                                 HorizontalAlignment="Center" />
                    </Border>
                  </Grid>
                </Border>

                <!-- Parameters Table Rows -->
                <StackPanel Grid.Row="2">
                  <ItemsControl x:Name="ParametersItemsControl" ItemsSource="{Binding Parameters}">
                    <ItemsControl.ItemTemplate>
                      <DataTemplate>
                        <Border Background="{StaticResource RequestBarBackgroundBrush}"
                                BorderBrush="{StaticResource RequestBarBorderBrush}"
                                BorderThickness="0,0,0,1">
                          <Grid ColumnDefinitions="52,*,*,*,88">
                            <Border Grid.Column="0"
                                    BorderBrush="{StaticResource RequestBarBorderBrush}"
                                    BorderThickness="0,0,1,0"
                                    Padding="0,8">
                              <CheckBox IsChecked="{Binding IsEnabled, Mode=TwoWay}"
                                        MinWidth="0"
                                        HorizontalAlignment="Center"
                                        VerticalAlignment="Center" />
                            </Border>
                            <Border Grid.Column="1"
                                    BorderBrush="{StaticResource RequestBarBorderBrush}"
                                    BorderThickness="0,0,1,0">
                              <TextBox Text="{Binding ParamKey, Mode=TwoWay}"
                                       PlaceholderText="Key"
                                       Style="{StaticResource ParameterTextBoxStyle}" />
                            </Border>
                            <Border Grid.Column="2"
                                    BorderBrush="{StaticResource RequestBarBorderBrush}"
                                    BorderThickness="0,0,1,0">
                              <TextBox Text="{Binding ParamValue, Mode=TwoWay}"
                                       PlaceholderText="Value"
                                       Style="{StaticResource ParameterTextBoxStyle}" />
                            </Border>
                            <Border Grid.Column="3"
                                    BorderBrush="{StaticResource RequestBarBorderBrush}"
                                    BorderThickness="0,0,1,0">
                              <TextBox Text="{Binding Description, Mode=TwoWay}"
                                       PlaceholderText="Description"
                                       Style="{StaticResource ParameterTextBoxStyle}" />
                            </Border>
                            <StackPanel Grid.Column="4"
                                        Orientation="Horizontal"
                                        HorizontalAlignment="Center"
                                        VerticalAlignment="Center"
                                        Spacing="4">
                              <Button Style="{StaticResource IconButtonStyle}"
                                      ToolTipService.ToolTip="Delete parameter"
                                      Click="DeleteParameter_Click">
                                <FontIcon Glyph="{StaticResource IconGlyphDelete}" FontSize="12" Foreground="{StaticResource ErrorBrush}" />
                              </Button>
                            </StackPanel>
                          </Grid>
                        </Border>
                      </DataTemplate>
                    </ItemsControl.ItemTemplate>
                  </ItemsControl>

                  <!-- Add Parameter Row -->
                  <Border Background="{StaticResource RequestBarBackgroundBrush}"
                          BorderBrush="{StaticResource RequestBarBorderBrush}"
                          BorderThickness="0,0,0,1"
                          Padding="16,12">
                    <Button Click="AddParameter_Click"
                            Style="{StaticResource IconButtonStyle}"
                            HorizontalAlignment="Left"
                            ToolTipService.ToolTip="Add new parameter">
                      <StackPanel Orientation="Horizontal" Spacing="8">
                        <FontIcon Glyph="{StaticResource IconGlyphAdd}"
                                  FontSize="14"
                                  Foreground="{StaticResource AccentPrimaryBrush}" />
                        <TextBlock Text="Add Parameter"
                                   Foreground="{StaticResource AccentPrimaryBrush}"
                                   FontFamily="{StaticResource AppFontFamilyMedium}"
                                   FontSize="13"
                                   VerticalAlignment="Center" />
                      </StackPanel>
                    </Button>
                  </Border>
                </StackPanel>
              </Grid>
            </ScrollViewer>

            <!-- Body Tab Panel (Index 1) -->
            <Grid x:Name="BodyPanel" Visibility="Collapsed" RowDefinitions="Auto,*">
              <!-- Body Header with Content Type -->
              <Border Grid.Row="0"
                      Background="{StaticResource RequestBarBackgroundBrush}"
                      BorderBrush="{StaticResource RequestBarBorderBrush}"
                      BorderThickness="0,0,0,1"
                      Padding="16,10">
                <Grid ColumnDefinitions="Auto,Auto,Auto,*,Auto">
                  <TextBlock Text="Content Type"
                             Foreground="{StaticResource TextSecondaryBrush}"
                             FontFamily="{StaticResource AppFontFamilyMedium}"
                             FontSize="13"
                             VerticalAlignment="Center"
                             Margin="0,0,12,0" />
                  
                  <!-- Content Type Dropdown -->
                  <ComboBox Grid.Column="1"
                            x:Name="ContentTypeComboBox"
                            ItemsSource="{Binding ContentTypes}"
                            SelectedItem="{Binding SelectedContentType, Mode=TwoWay}"
                            MinWidth="180"
                            Background="{StaticResource MethodSelectorBgBrush}"
                            BorderThickness="1"
                            BorderBrush="{StaticResource RequestBarBorderBrush}"
                            Padding="12,8"
                            Margin="0,0,16,0">
                    <ComboBox.ItemTemplate>
                      <DataTemplate>
                        <TextBlock Text="{Binding Name}"
                                   Foreground="{StaticResource TextPrimaryBrush}"
                                   FontFamily="{StaticResource MonospaceFontFamily}"
                                   FontSize="13" />
                      </DataTemplate>
                    </ComboBox.ItemTemplate>
                  </ComboBox>
                  
                  <!-- Override Toggle -->
                  <StackPanel Grid.Column="2"
                              Orientation="Horizontal"
                              Spacing="8"
                              VerticalAlignment="Center">
                    <FontIcon Glyph="{StaticResource IconGlyphSync}"
                              FontSize="14"
                              Foreground="{StaticResource TextMutedBrush}" />
                    <TextBlock Text="Override"
                               Foreground="{StaticResource TextSecondaryBrush}"
                               FontFamily="{StaticResource AppFontFamilyMedium}"
                               FontSize="13"
                               VerticalAlignment="Center" />
                    <CheckBox IsChecked="{Binding OverrideContentType, Mode=TwoWay}"
                              MinWidth="0"
                              VerticalAlignment="Center" />
                  </StackPanel>
                  
                  <!-- Right side toolbar -->
                  <StackPanel Grid.Column="4"
                              Orientation="Horizontal"
                              Spacing="4">
                    <Button Style="{StaticResource IconButtonStyle}"
                            ToolTipService.ToolTip="Clear body">
                      <FontIcon Glyph="{StaticResource IconGlyphDelete}" FontSize="14" Foreground="{StaticResource TextMutedBrush}" />
                    </Button>
                    <Button Style="{StaticResource IconButtonStyle}"
                            ToolTipService.ToolTip="Copy body">
                      <FontIcon Glyph="{StaticResource IconGlyphCopy}" FontSize="14" Foreground="{StaticResource TextMutedBrush}" />
                    </Button>
                    <Button Style="{StaticResource IconButtonStyle}"
                            ToolTipService.ToolTip="Format JSON"
                            Click="FormatJson_Click">
                      <FontIcon Glyph="{StaticResource IconGlyphEdit}" FontSize="14" Foreground="{StaticResource TextMutedBrush}" />
                    </Button>
                  </StackPanel>
                </Grid>
              </Border>
              
              <!-- Code Editor with Line Numbers -->
              <Border Grid.Row="1"
                      Background="{StaticResource RequestBarBackgroundBrush}"
                      Margin="0">
                <Grid ColumnDefinitions="Auto,*">
                  <!-- Line Numbers -->
                  <Border Grid.Column="0"
                          Background="{StaticResource SurfaceVariantBrush}"
                          BorderBrush="{StaticResource RequestBarBorderBrush}"
                          BorderThickness="0,0,1,0"
                          Padding="8,12"
                          MinWidth="48">
                    <ItemsControl x:Name="LineNumbersControl">
                      <ItemsControl.ItemTemplate>
                        <DataTemplate>
                          <TextBlock Text="{Binding}"
                                     Foreground="{StaticResource TextMutedBrush}"
                                     FontFamily="{StaticResource MonospaceFontFamily}"
                                     FontSize="13"
                                     HorizontalAlignment="Right"
                                     Padding="0,1" />
                        </DataTemplate>
                      </ItemsControl.ItemTemplate>
                    </ItemsControl>
                  </Border>
                  
                  <!-- Code Editor -->
                  <ScrollViewer Grid.Column="1"
                                HorizontalScrollBarVisibility="Auto"
                                VerticalScrollBarVisibility="Auto">
                    <TextBox x:Name="BodyTextBox"
                             Text="{Binding BodyText, Mode=TwoWay}"
                             AcceptsReturn="True"
                             TextWrapping="NoWrap"
                             Background="Transparent"
                             Foreground="{StaticResource TextPrimaryBrush}"
                             FontFamily="{StaticResource MonospaceFontFamily}"
                             FontSize="13"
                             BorderThickness="0"
                             Padding="12"
                             MinHeight="400"
                             TextChanged="BodyTextBox_TextChanged"
                             PlaceholderText="Enter request body here..." />
                  </ScrollViewer>
                </Grid>
              </Border>
            </Grid>

            <!-- Headers Tab Panel (Index 2) -->
            <ScrollViewer x:Name="HeadersPanel" Visibility="Collapsed">
              <Grid RowDefinitions="Auto,Auto,*" Padding="0">
                <!-- Headers Section Header -->
                <Border Grid.Row="0"
                        Background="{StaticResource RequestBarBackgroundBrush}"
                        BorderBrush="{StaticResource RequestBarBorderBrush}"
                        BorderThickness="0,0,0,1"
                        Padding="16,12">
                  <Grid ColumnDefinitions="*,Auto">
                    <StackPanel Orientation="Horizontal" Spacing="12" VerticalAlignment="Center">
                      <TextBlock Text="Header List"
                                 Foreground="{StaticResource TextSecondaryBrush}"
                                 FontFamily="{StaticResource AppFontFamilySemiBold}"
                                 FontSize="13"
                                 VerticalAlignment="Center" />
                      <Border Background="{StaticResource SurfaceVariantBrush}"
                              CornerRadius="10"
                              Padding="8,2">
                        <TextBlock Text="{Binding Headers.Count}"
                                   Foreground="{StaticResource TextMutedBrush}"
                                   FontFamily="{StaticResource MonospaceFontFamily}"
                                   FontSize="11"
                                   VerticalAlignment="Center" />
                      </Border>
                    </StackPanel>
                    <StackPanel Grid.Column="1" Orientation="Horizontal" Spacing="4">
                      <Button Style="{StaticResource IconButtonStyle}"
                              Click="ClearAllHeaders_Click"
                              ToolTipService.ToolTip="Clear all headers">
                        <FontIcon Glyph="{StaticResource IconGlyphDelete}" FontSize="14" Foreground="{StaticResource TextMutedBrush}" />
                      </Button>
                      <Button Style="{StaticResource IconButtonStyle}"
                              ToolTipService.ToolTip="Copy headers">
                        <FontIcon Glyph="{StaticResource IconGlyphCopy}" FontSize="14" Foreground="{StaticResource TextMutedBrush}" />
                      </Button>
                      <Button Style="{StaticResource IconButtonStyle}"
                              ToolTipService.ToolTip="Import headers">
                        <FontIcon Glyph="{StaticResource IconGlyphEdit}" FontSize="14" Foreground="{StaticResource TextMutedBrush}" />
                      </Button>
                      <Button Style="{StaticResource IconButtonStyle}"
                              Click="AddHeader_Click"
                              ToolTipService.ToolTip="Add header">
                        <FontIcon Glyph="{StaticResource IconGlyphAdd}" FontSize="14" Foreground="{StaticResource AccentPrimaryBrush}" />
                      </Button>
                    </StackPanel>
                  </Grid>
                </Border>

                <!-- Headers Table Header -->
                <Border Grid.Row="1"
                        Background="{StaticResource TabBarBackgroundBrush}"
                        BorderBrush="{StaticResource RequestBarBorderBrush}"
                        BorderThickness="0,0,0,1"
                        Padding="0">
                  <Grid ColumnDefinitions="52,*,*,*,88">
                    <Border Grid.Column="0"
                            BorderBrush="{StaticResource RequestBarBorderBrush}"
                            BorderThickness="0,0,1,0"
                            Padding="0,10" />
                    <Border Grid.Column="1"
                            BorderBrush="{StaticResource RequestBarBorderBrush}"
                            BorderThickness="0,0,1,0"
                            Padding="16,10">
                      <TextBlock Text="Key"
                                 Foreground="{StaticResource TextMutedBrush}"
                                 FontFamily="{StaticResource AppFontFamilyMedium}"
                                 FontSize="12" />
                    </Border>
                    <Border Grid.Column="2"
                            BorderBrush="{StaticResource RequestBarBorderBrush}"
                            BorderThickness="0,0,1,0"
                            Padding="16,10">
                      <TextBlock Text="Value"
                                 Foreground="{StaticResource TextMutedBrush}"
                                 FontFamily="{StaticResource AppFontFamilyMedium}"
                                 FontSize="12" />
                    </Border>
                    <Border Grid.Column="3"
                            BorderBrush="{StaticResource RequestBarBorderBrush}"
                            BorderThickness="0,0,1,0"
                            Padding="16,10">
                      <TextBlock Text="Description"
                                 Foreground="{StaticResource TextMutedBrush}"
                                 FontFamily="{StaticResource AppFontFamilyMedium}"
                                 FontSize="12" />
                    </Border>
                    <Border Grid.Column="4"
                            Padding="8,10">
                      <TextBlock Text="Actions"
                                 Foreground="{StaticResource TextMutedBrush}"
                                 FontFamily="{StaticResource AppFontFamilyMedium}"
                                 FontSize="12"
                                 HorizontalAlignment="Center" />
                    </Border>
                  </Grid>
                </Border>

                <!-- Headers Table Rows -->
                <StackPanel Grid.Row="2">
                  <ItemsControl x:Name="HeadersItemsControl" ItemsSource="{Binding Headers}">
                    <ItemsControl.ItemTemplate>
                      <DataTemplate>
                        <Border Background="{StaticResource RequestBarBackgroundBrush}"
                                BorderBrush="{StaticResource RequestBarBorderBrush}"
                                BorderThickness="0,0,0,1">
                          <Grid ColumnDefinitions="52,*,*,*,88">
                            <Border Grid.Column="0"
                                    BorderBrush="{StaticResource RequestBarBorderBrush}"
                                    BorderThickness="0,0,1,0"
                                    Padding="0,8">
                              <CheckBox IsChecked="{Binding IsEnabled, Mode=TwoWay}"
                                        MinWidth="0"
                                        HorizontalAlignment="Center"
                                        VerticalAlignment="Center" />
                            </Border>
                            <Border Grid.Column="1"
                                    BorderBrush="{StaticResource RequestBarBorderBrush}"
                                    BorderThickness="0,0,1,0">
                              <AutoSuggestBox Text="{Binding HeaderKey, Mode=TwoWay}"
                                              PlaceholderText="Type or select header..."
                                              Background="Transparent"
                                              BorderThickness="0"
                                              FontFamily="{StaticResource MonospaceFontFamily}"
                                              FontSize="13"
                                              Padding="16,10"
                                              TextChanged="HeaderKey_TextChanged"
                                              SuggestionChosen="HeaderKey_SuggestionChosen"
                                              HorizontalAlignment="Stretch">
                                <AutoSuggestBox.TextBoxStyle>
                                  <Style TargetType="TextBox">
                                    <Setter Property="Padding" Value="16,10" />
                                    <Setter Property="FontFamily" Value="{StaticResource MonospaceFontFamily}" />
                                    <Setter Property="FontSize" Value="13" />
                                  </Style>
                                </AutoSuggestBox.TextBoxStyle>
                              </AutoSuggestBox>
                            </Border>
                            <Border Grid.Column="2"
                                    BorderBrush="{StaticResource RequestBarBorderBrush}"
                                    BorderThickness="0,0,1,0">
                              <TextBox Text="{Binding HeaderValue, Mode=TwoWay}"
                                       PlaceholderText="Value"
                                       Style="{StaticResource ParameterTextBoxStyle}" />
                            </Border>
                            <Border Grid.Column="3"
                                    BorderBrush="{StaticResource RequestBarBorderBrush}"
                                    BorderThickness="0,0,1,0">
                              <TextBox Text="{Binding Description, Mode=TwoWay}"
                                       PlaceholderText="Description"
                                       Style="{StaticResource ParameterTextBoxStyle}" />
                            </Border>
                            <StackPanel Grid.Column="4"
                                        Orientation="Horizontal"
                                        HorizontalAlignment="Center"
                                        VerticalAlignment="Center"
                                        Spacing="4">
                              <Button Style="{StaticResource IconButtonStyle}"
                                      ToolTipService.ToolTip="Toggle active"
                                      Click="ToggleHeaderActive_Click">
                                <FontIcon Glyph="&#xE73E;" FontSize="12" Foreground="{StaticResource SuccessBrush}" />
                              </Button>
                              <Button Style="{StaticResource IconButtonStyle}"
                                      ToolTipService.ToolTip="Delete header"
                                      Click="DeleteHeader_Click">
                                <FontIcon Glyph="{StaticResource IconGlyphDelete}" FontSize="12" Foreground="{StaticResource ErrorBrush}" />
                              </Button>
                            </StackPanel>
                          </Grid>
                        </Border>
                      </DataTemplate>
                    </ItemsControl.ItemTemplate>
                  </ItemsControl>

                  <!-- Add Header Row -->
                  <Border Background="{StaticResource RequestBarBackgroundBrush}"
                          BorderBrush="{StaticResource RequestBarBorderBrush}"
                          BorderThickness="0,0,0,1"
                          Padding="16,12">
                    <Button Click="AddHeader_Click"
                            Style="{StaticResource IconButtonStyle}"
                            HorizontalAlignment="Left"
                            ToolTipService.ToolTip="Add new header">
                      <StackPanel Orientation="Horizontal" Spacing="8">
                        <FontIcon Glyph="{StaticResource IconGlyphAdd}"
                                  FontSize="14"
                                  Foreground="{StaticResource AccentPrimaryBrush}" />
                        <TextBlock Text="Add Header"
                                   Foreground="{StaticResource AccentPrimaryBrush}"
                                   FontFamily="{StaticResource AppFontFamilyMedium}"
                                   FontSize="13"
                                   VerticalAlignment="Center" />
                      </StackPanel>
                    </Button>
                  </Border>
                </StackPanel>
              </Grid>
            </ScrollViewer>

            <!-- Authorization Tab Panel (Index 3) -->
            <Grid x:Name="AuthPanel" Visibility="Collapsed">
              <Border Background="{StaticResource RequestBarBackgroundBrush}" Padding="16">
                <TextBlock Text="Authorization configuration coming soon..."
                           Foreground="{StaticResource TextMutedBrush}"
                           FontFamily="{StaticResource AppFontFamily}"
                           FontSize="14" />
              </Border>
            </Grid>

            <!-- Pre-request Script Tab Panel (Index 4) -->
            <Grid x:Name="PreScriptPanel" Visibility="Collapsed">
              <Border Background="{StaticResource RequestBarBackgroundBrush}" Padding="16">
                <TextBlock Text="Pre-request script coming soon..."
                           Foreground="{StaticResource TextMutedBrush}"
                           FontFamily="{StaticResource AppFontFamily}"
                           FontSize="14" />
              </Border>
            </Grid>

            <!-- Post-request Script Tab Panel (Index 5) -->
            <Grid x:Name="PostScriptPanel" Visibility="Collapsed">
              <Border Background="{StaticResource RequestBarBackgroundBrush}" Padding="16">
                <TextBlock Text="Post-request script coming soon..."
                           Foreground="{StaticResource TextMutedBrush}"
                           FontFamily="{StaticResource AppFontFamily}"
                           FontSize="14" />
              </Border>
            </Grid>
          </Grid>

          <!-- Response Section - Always visible at bottom -->
          <Border Grid.Row="3"
                  Background="{StaticResource RequestBarBackgroundBrush}"
                  BorderBrush="{StaticResource RequestBarBorderBrush}"
                  BorderThickness="0,1,0,0">
            <Grid RowDefinitions="Auto,Auto,Auto,*">
              <!-- Response Status Bar -->
              <Border Grid.Row="0"
                      Background="{StaticResource SurfaceVariantBrush}"
                      BorderBrush="{StaticResource RequestBarBorderBrush}"
                      BorderThickness="0,0,0,1"
                      Padding="12,8">
                <Grid ColumnDefinitions="Auto,Auto,Auto,Auto,*">
                  <StackPanel Orientation="Horizontal" Spacing="8">
                    <TextBlock Text="Status:"
                               Foreground="{StaticResource TextMutedBrush}"
                               FontFamily="{StaticResource AppFontFamilyMedium}"
                               FontSize="12"
                               VerticalAlignment="Center" />
                    <Border x:Name="StatusBadge"
                            Background="{StaticResource SuccessBrush}"
                            CornerRadius="4"
                            Padding="8,4">
                      <TextBlock Text="{Binding ResponseStatus}"
                                 Foreground="{StaticResource OverlayBrush}"
                                 FontFamily="{StaticResource AppFontFamilyBold}"
                                 FontSize="11" />
                    </Border>
                  </StackPanel>
                  <StackPanel Grid.Column="1" Orientation="Horizontal" Spacing="8" Margin="20,0,0,0">
                    <TextBlock Text="Time:"
                               Foreground="{StaticResource TextMutedBrush}"
                               FontFamily="{StaticResource AppFontFamilyMedium}"
                               FontSize="12"
                               VerticalAlignment="Center" />
                    <TextBlock x:Name="ResponseTimeText"
                               Text="{Binding ResponseTime}"
                               Foreground="{StaticResource AccentPrimaryBrush}"
                               FontFamily="{StaticResource MonospaceFontFamily}"
                               FontSize="12"
                               VerticalAlignment="Center" />
                  </StackPanel>
                  <StackPanel Grid.Column="2" Orientation="Horizontal" Spacing="8" Margin="20,0,0,0">
                    <TextBlock Text="Size:"
                               Foreground="{StaticResource TextMutedBrush}"
                               FontFamily="{StaticResource AppFontFamilyMedium}"
                               FontSize="12"
                               VerticalAlignment="Center" />
                    <TextBlock x:Name="ResponseSizeText"
                               Text="{Binding ResponseSize}"
                               Foreground="{StaticResource AccentPrimaryBrush}"
                               FontFamily="{StaticResource MonospaceFontFamily}"
                               FontSize="12"
                               VerticalAlignment="Center" />
                  </StackPanel>
                </Grid>
              </Border>

              <!-- Response Tabs and Toolbar -->
              <Border Grid.Row="1"
                      Background="{StaticResource TabBarBackgroundBrush}"
                      BorderBrush="{StaticResource RequestBarBorderBrush}"
                      BorderThickness="0,0,0,1">
                <Grid ColumnDefinitions="*,Auto">
                  <!-- Response Tabs -->
                  <StackPanel Orientation="Horizontal">
                    <Button x:Name="ResponseTabJson"
                            Content="JSON"
                            Tag="0"
                            Click="ResponseTab_Click"
                            Style="{StaticResource RequestTabActiveStyle}" />
                    <Button x:Name="ResponseTabRaw"
                            Content="Raw"
                            Tag="1"
                            Click="ResponseTab_Click"
                            Style="{StaticResource RequestTabStyle}" />
                    <Button x:Name="ResponseTabHeaders"
                            Content="Headers"
                            Tag="2"
                            Click="ResponseTab_Click"
                            Style="{StaticResource RequestTabStyle}" />
                    <Button x:Name="ResponseTabTestResults"
                            Content="Test Results"
                            Tag="3"
                            Click="ResponseTab_Click"
                            Style="{StaticResource RequestTabStyle}" />
                  </StackPanel>

                  <!-- Response Toolbar -->
                  <StackPanel Grid.Column="1" Orientation="Horizontal" Spacing="2" Margin="0,0,8,0">
                    <!-- Filter/Search -->
                    <Border Background="{StaticResource InputBackgroundBrush}"
                            CornerRadius="4"
                            Padding="4,0"
                            Margin="0,4">
                      <StackPanel Orientation="Horizontal">
                        <FontIcon Glyph="&#xE721;" FontSize="12" Foreground="{StaticResource TextMutedBrush}" Margin="4,0" VerticalAlignment="Center" />
                        <TextBox x:Name="ResponseFilterBox"
                                 PlaceholderText="Filter..."
                                 Width="120"
                                 Background="Transparent"
                                 BorderThickness="0"
                                 FontFamily="{StaticResource MonospaceFontFamily}"
                                 FontSize="11"
                                 Padding="4,6"
                                 TextChanged="ResponseFilter_TextChanged" />
                      </StackPanel>
                    </Border>
                    <Border Width="1" Background="{StaticResource RequestBarBorderBrush}" Margin="8,8" />
                    <!-- Wrap Lines Toggle -->
                    <Button x:Name="WrapLinesToggle"
                            Style="{StaticResource IconButtonStyle}"
                            ToolTipService.ToolTip="Wrap Lines"
                            Click="WrapLines_Click">
                      <FontIcon x:Name="WrapIcon" Glyph="&#xE8B3;" FontSize="14" Foreground="{StaticResource TextMutedBrush}" />
                    </Button>
                    <Border Width="1" Background="{StaticResource RequestBarBorderBrush}" Margin="4,8" />
                    <!-- Download -->
                    <Button Style="{StaticResource IconButtonStyle}"
                            Click="DownloadResponse_Click"
                            ToolTipService.ToolTip="Download Response">
                      <FontIcon Glyph="&#xE896;" FontSize="14" Foreground="{StaticResource TextMutedBrush}" />
                    </Button>
                    <!-- Copy -->
                    <Button x:Name="CopyResponseButton"
                            Style="{StaticResource IconButtonStyle}"
                            Click="CopyResponse_Click"
                            ToolTipService.ToolTip="Copy Response">
                      <FontIcon x:Name="CopyResponseIcon" Glyph="{StaticResource IconGlyphCopy}" FontSize="14" Foreground="{StaticResource TextMutedBrush}" />
                    </Button>
                    <!-- Clear -->
                    <Button Style="{StaticResource IconButtonStyle}"
                            Command="{Binding ResetResponse}"
                            ToolTipService.ToolTip="Clear Response">
                      <FontIcon Glyph="{StaticResource IconGlyphDelete}" FontSize="14" Foreground="{StaticResource TextMutedBrush}" />
                    </Button>
                  </StackPanel>
                </Grid>
              </Border>

              <!-- Error Message -->
              <TextBlock Grid.Row="2"
                         Text="{Binding ErrorMessage}"
                         Foreground="{StaticResource ErrorBrush}"
                         FontFamily="{StaticResource AppFontFamily}"
                         FontSize="12"
                         Padding="12,8"
                         Visibility="{Binding ErrorMessage, Converter={StaticResource NullToCollapsedConverter}, FallbackValue=Collapsed}" />

              <!-- Response Content Area -->
              <Grid Grid.Row="3" MinHeight="200" MaxHeight="350">
                <!-- JSON View Panel -->
                <Grid x:Name="ResponseJsonPanel" Visibility="Visible">
                  <Grid ColumnDefinitions="Auto,*">
                    <!-- Line Numbers -->
                    <Border Grid.Column="0"
                            Background="{StaticResource SurfaceVariantBrush}"
                            BorderBrush="{StaticResource RequestBarBorderBrush}"
                            BorderThickness="0,0,1,0"
                            MinWidth="48">
                      <ScrollViewer x:Name="LineNumbersScroller"
                                    VerticalScrollBarVisibility="Hidden"
                                    HorizontalScrollBarVisibility="Disabled">
                        <ItemsControl x:Name="ResponseLineNumbersControl">
                          <ItemsControl.ItemTemplate>
                            <DataTemplate>
                              <TextBlock Text="{Binding}"
                                         Foreground="{StaticResource TextMutedBrush}"
                                         FontFamily="{StaticResource MonospaceFontFamily}"
                                         FontSize="12"
                                         HorizontalAlignment="Right"
                                         Padding="8,1,12,1" />
                            </DataTemplate>
                          </ItemsControl.ItemTemplate>
                        </ItemsControl>
                      </ScrollViewer>
                    </Border>
                    
                    <!-- JSON Content with Syntax Highlighting -->
                    <ScrollViewer x:Name="ResponseContentScroller"
                                  Grid.Column="1"
                                  HorizontalScrollBarVisibility="Auto"
                                  VerticalScrollBarVisibility="Auto"
                                  ViewChanged="ResponseContent_ViewChanged"
                                  Padding="12,8">
                      <StackPanel>
                        <TextBlock x:Name="ResponseHighlightBlock"
                                   FontFamily="{StaticResource MonospaceFontFamily}"
                                   FontSize="12"
                                   TextWrapping="NoWrap"
                                   IsTextSelectionEnabled="True" />
                        <TextBlock x:Name="ResponseBodyText"
                                   Text="{Binding ResponseBody}"
                                   Visibility="Collapsed" />
                      </StackPanel>
                    </ScrollViewer>
                  </Grid>
                </Grid>

                <!-- Raw View Panel -->
                <Grid x:Name="ResponseRawPanel" Visibility="Collapsed">
                  <Grid ColumnDefinitions="Auto,*">
                    <Border Grid.Column="0"
                            Background="{StaticResource SurfaceVariantBrush}"
                            BorderBrush="{StaticResource RequestBarBorderBrush}"
                            BorderThickness="0,0,1,0"
                            MinWidth="48">
                      <ScrollViewer x:Name="RawLineNumbersScroller"
                                    VerticalScrollBarVisibility="Hidden"
                                    HorizontalScrollBarVisibility="Disabled">
                        <ItemsControl x:Name="RawLineNumbersControl">
                          <ItemsControl.ItemTemplate>
                            <DataTemplate>
                              <TextBlock Text="{Binding}"
                                         Foreground="{StaticResource TextMutedBrush}"
                                         FontFamily="{StaticResource MonospaceFontFamily}"
                                         FontSize="12"
                                         HorizontalAlignment="Right"
                                         Padding="8,1,12,1" />
                            </DataTemplate>
                          </ItemsControl.ItemTemplate>
                        </ItemsControl>
                      </ScrollViewer>
                    </Border>
                    <ScrollViewer x:Name="RawContentScroller"
                                  Grid.Column="1"
                                  HorizontalScrollBarVisibility="Auto"
                                  VerticalScrollBarVisibility="Auto"
                                  ViewChanged="RawContent_ViewChanged"
                                  Padding="12,8">
                      <TextBlock x:Name="ResponseRawText"
                                 Text="{Binding ResponseBody}"
                                 FontFamily="{StaticResource MonospaceFontFamily}"
                                 FontSize="12"
                                 Foreground="{StaticResource TextPrimaryBrush}"
                                 TextWrapping="NoWrap"
                                 IsTextSelectionEnabled="True" />
                    </ScrollViewer>
                  </Grid>
                </Grid>

                <!-- Headers View Panel -->
                <ScrollViewer x:Name="ResponseHeadersPanel" Visibility="Collapsed">
                  <Grid RowDefinitions="Auto,*" Padding="0">
                    <!-- Headers Table Header -->
                    <Border Grid.Row="0"
                            Background="{StaticResource SurfaceVariantBrush}"
                            BorderBrush="{StaticResource RequestBarBorderBrush}"
                            BorderThickness="0,0,0,1"
                            Padding="0">
                      <Grid ColumnDefinitions="*,2*">
                        <Border Grid.Column="0"
                                BorderBrush="{StaticResource RequestBarBorderBrush}"
                                BorderThickness="0,0,1,0"
                                Padding="16,10">
                          <TextBlock Text="Header"
                                     Foreground="{StaticResource TextMutedBrush}"
                                     FontFamily="{StaticResource AppFontFamilySemiBold}"
                                     FontSize="12" />
                        </Border>
                        <Border Grid.Column="1" Padding="16,10">
                          <TextBlock Text="Value"
                                     Foreground="{StaticResource TextMutedBrush}"
                                     FontFamily="{StaticResource AppFontFamilySemiBold}"
                                     FontSize="12" />
                        </Border>
                      </Grid>
                    </Border>
                    <!-- Headers List -->
                    <ItemsControl Grid.Row="1" x:Name="ResponseHeadersControl" ItemsSource="{Binding ResponseHeaders}">
                      <ItemsControl.ItemTemplate>
                        <DataTemplate>
                          <Border Background="{StaticResource RequestBarBackgroundBrush}"
                                  BorderBrush="{StaticResource RequestBarBorderBrush}"
                                  BorderThickness="0,0,0,1">
                            <Grid ColumnDefinitions="*,2*">
                              <Border Grid.Column="0"
                                      BorderBrush="{StaticResource RequestBarBorderBrush}"
                                      BorderThickness="0,0,1,0"
                                      Padding="16,10">
                                <TextBlock Text="{Binding Key}"
                                           Foreground="{StaticResource AccentPrimaryBrush}"
                                           FontFamily="{StaticResource MonospaceFontFamily}"
                                           FontSize="12"
                                           IsTextSelectionEnabled="True" />
                              </Border>
                              <Border Grid.Column="1" Padding="16,10">
                                <TextBlock Text="{Binding Value}"
                                           Foreground="{StaticResource TextPrimaryBrush}"
                                           FontFamily="{StaticResource MonospaceFontFamily}"
                                           FontSize="12"
                                           TextWrapping="Wrap"
                                           IsTextSelectionEnabled="True" />
                              </Border>
                            </Grid>
                          </Border>
                        </DataTemplate>
                      </ItemsControl.ItemTemplate>
                    </ItemsControl>
                  </Grid>
                </ScrollViewer>

                <!-- Test Results Panel -->
                <Grid x:Name="ResponseTestResultsPanel" Visibility="Collapsed">
                  <Border Background="{StaticResource RequestBarBackgroundBrush}" Padding="16">
                    <StackPanel VerticalAlignment="Center" HorizontalAlignment="Center" Spacing="8">
                      <FontIcon Glyph="&#xE9D9;" FontSize="32" Foreground="{StaticResource TextMutedBrush}" />
                      <TextBlock Text="No test results"
                                 Foreground="{StaticResource TextMutedBrush}"
                                 FontFamily="{StaticResource AppFontFamily}"
                                 FontSize="14"
                                 HorizontalAlignment="Center" />
                      <TextBlock Text="Write tests in the Pre/Post-request Script tabs"
                                 Foreground="{StaticResource TextSubtleBrush}"
                                 FontFamily="{StaticResource AppFontFamily}"
                                 FontSize="12"
                                 HorizontalAlignment="Center" />
                    </StackPanel>
                  </Border>
                </Grid>
              </Grid>
            </Grid>
          </Border>
        </Grid>
      </NavigationView.Content>
    </NavigationView>
  </Grid>
</Page>