<UserControl x:Class="DevFlow.Controls.ResponseViewerControl"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:local="using:DevFlow.Controls">
    
    <Grid RowDefinitions="Auto,Auto,Auto,*">
        <!-- Response Status Bar -->
        <Border Grid.Row="0"
                Background="{StaticResource SurfaceVariantBrush}"
                BorderBrush="{StaticResource RequestBarBorderBrush}"
                BorderThickness="0,0,0,1"
                Padding="12,8">
            <Grid ColumnDefinitions="Auto,Auto,Auto,*">
                <StackPanel Orientation="Horizontal" Spacing="8">
                    <TextBlock Text="Status:"
                               Foreground="{StaticResource TextMutedBrush}"
                               FontFamily="{StaticResource AppFontFamilyMedium}"
                               FontSize="12"
                               VerticalAlignment="Center" />
                    <Border x:Name="StatusBadge"
                            Background="{StaticResource TextMutedBrush}"
                            CornerRadius="4"
                            Padding="8,4">
                        <TextBlock x:Name="StatusText"
                                   Text="Awaiting request"
                                   Foreground="{StaticResource OverlayBrush}"
                                   FontFamily="{StaticResource AppFontFamilyBold}"
                                   FontSize="11" />
                    </Border>
                </StackPanel>
                <StackPanel Grid.Column="1" Orientation="Horizontal" Spacing="8" Margin="20,0,0,0">
                    <TextBlock Text="Time:"
                               Foreground="{StaticResource TextMutedBrush}"
                               FontFamily="{StaticResource AppFontFamilyMedium}"
                               FontSize="12"
                               VerticalAlignment="Center" />
                    <TextBlock x:Name="TimeText"
                               Text="0 ms"
                               Foreground="{StaticResource AccentPrimaryBrush}"
                               FontFamily="{StaticResource MonospaceFontFamily}"
                               FontSize="12"
                               VerticalAlignment="Center" />
                </StackPanel>
                <StackPanel Grid.Column="2" Orientation="Horizontal" Spacing="8" Margin="20,0,0,0">
                    <TextBlock Text="Size:"
                               Foreground="{StaticResource TextMutedBrush}"
                               FontFamily="{StaticResource AppFontFamilyMedium}"
                               FontSize="12"
                               VerticalAlignment="Center" />
                    <TextBlock x:Name="SizeText"
                               Text="0 KB"
                               Foreground="{StaticResource AccentPrimaryBrush}"
                               FontFamily="{StaticResource MonospaceFontFamily}"
                               FontSize="12"
                               VerticalAlignment="Center" />
                </StackPanel>
            </Grid>
        </Border>

        <!-- Response Tabs and Toolbar -->
        <Border Grid.Row="1"
                Background="{StaticResource TabBarBackgroundBrush}"
                BorderBrush="{StaticResource RequestBarBorderBrush}"
                BorderThickness="0,0,0,1">
            <Grid ColumnDefinitions="*,Auto">
                <!-- Response Tabs -->
                <StackPanel Orientation="Horizontal">
                    <Button x:Name="TabJson"
                            Content="JSON"
                            Tag="0"
                            Click="Tab_Click"
                            Style="{StaticResource RequestTabActiveStyle}" />
                    <Button x:Name="TabRaw"
                            Content="Raw"
                            Tag="1"
                            Click="Tab_Click"
                            Style="{StaticResource RequestTabStyle}" />
                    <Button x:Name="TabHeaders"
                            Content="Headers"
                            Tag="2"
                            Click="Tab_Click"
                            Style="{StaticResource RequestTabStyle}" />
                </StackPanel>

                <!-- Response Toolbar -->
                <StackPanel Grid.Column="1" Orientation="Horizontal" Spacing="2" Margin="0,0,8,0">
                    <!-- Filter/Search -->
                    <Border Background="{StaticResource InputBackgroundBrush}"
                            CornerRadius="4"
                            Padding="4,0"
                            Margin="0,4">
                        <StackPanel Orientation="Horizontal">
                            <FontIcon Glyph="&#xE721;" FontSize="12" Foreground="{StaticResource TextMutedBrush}" Margin="4,0" VerticalAlignment="Center" />
                            <TextBox x:Name="FilterBox"
                                     PlaceholderText="Filter..."
                                     Width="120"
                                     Background="Transparent"
                                     BorderThickness="0"
                                     FontFamily="{StaticResource MonospaceFontFamily}"
                                     FontSize="11"
                                     Padding="4,6"
                                     TextChanged="Filter_TextChanged" />
                        </StackPanel>
                    </Border>
                    <Border Width="1" Background="{StaticResource RequestBarBorderBrush}" Margin="8,8" />
                    <!-- Wrap Lines Toggle -->
                    <Button x:Name="WrapLinesToggle"
                            Style="{StaticResource IconButtonStyle}"
                            ToolTipService.ToolTip="Wrap Lines"
                            Click="WrapLines_Click">
                        <FontIcon x:Name="WrapIcon" Glyph="&#xE8B3;" FontSize="14" Foreground="{StaticResource TextMutedBrush}" />
                    </Button>
                    <Border Width="1" Background="{StaticResource RequestBarBorderBrush}" Margin="4,8" />
                    <!-- Download -->
                    <Button Style="{StaticResource IconButtonStyle}"
                            Click="Download_Click"
                            ToolTipService.ToolTip="Download Response">
                        <FontIcon Glyph="&#xE896;" FontSize="14" Foreground="{StaticResource TextMutedBrush}" />
                    </Button>
                    <!-- Copy -->
                    <Button x:Name="CopyButton"
                            Style="{StaticResource IconButtonStyle}"
                            Click="Copy_Click"
                            ToolTipService.ToolTip="Copy Response">
                        <FontIcon x:Name="CopyIcon" Glyph="{StaticResource IconGlyphCopy}" FontSize="14" Foreground="{StaticResource TextMutedBrush}" />
                    </Button>
                    <!-- Clear -->
                    <Button Style="{StaticResource IconButtonStyle}"
                            Click="Clear_Click"
                            ToolTipService.ToolTip="Clear Response">
                        <FontIcon Glyph="{StaticResource IconGlyphDelete}" FontSize="14" Foreground="{StaticResource TextMutedBrush}" />
                    </Button>
                </StackPanel>
            </Grid>
        </Border>

        <!-- Error Message -->
        <TextBlock Grid.Row="2"
                   x:Name="ErrorText"
                   Foreground="{StaticResource ErrorBrush}"
                   FontFamily="{StaticResource AppFontFamily}"
                   FontSize="12"
                   Padding="12,8"
                   Visibility="Collapsed" />

        <!-- Response Content Area -->
        <Grid Grid.Row="3">
            <!-- JSON View Panel -->
            <Grid x:Name="JsonPanel" Visibility="Visible">
                <Grid ColumnDefinitions="Auto,*">
                    <!-- Line Numbers -->
                    <Border Grid.Column="0"
                            Background="{StaticResource SurfaceVariantBrush}"
                            BorderBrush="{StaticResource RequestBarBorderBrush}"
                            BorderThickness="0,0,1,0"
                            MinWidth="48">
                        <ScrollViewer x:Name="JsonLineNumbersScroller"
                                      VerticalScrollBarVisibility="Hidden"
                                      HorizontalScrollBarVisibility="Disabled">
                            <ItemsControl x:Name="JsonLineNumbersControl">
                                <ItemsControl.ItemTemplate>
                                    <DataTemplate>
                                        <TextBlock Text="{Binding}"
                                                   Foreground="{StaticResource TextMutedBrush}"
                                                   FontFamily="{StaticResource MonospaceFontFamily}"
                                                   FontSize="12"
                                                   HorizontalAlignment="Right"
                                                   Padding="8,1,12,1" />
                                    </DataTemplate>
                                </ItemsControl.ItemTemplate>
                            </ItemsControl>
                        </ScrollViewer>
                    </Border>
                    
                    <!-- JSON Content with Syntax Highlighting -->
                    <ScrollViewer x:Name="JsonContentScroller"
                                  Grid.Column="1"
                                  HorizontalScrollBarVisibility="Auto"
                                  VerticalScrollBarVisibility="Auto"
                                  ViewChanged="JsonContent_ViewChanged"
                                  Padding="12,8">
                        <TextBlock x:Name="JsonHighlightBlock"
                                   FontFamily="{StaticResource MonospaceFontFamily}"
                                   FontSize="12"
                                   TextWrapping="NoWrap"
                                   IsTextSelectionEnabled="True" />
                    </ScrollViewer>
                </Grid>
            </Grid>

            <!-- Raw View Panel -->
            <Grid x:Name="RawPanel" Visibility="Collapsed">
                <Grid ColumnDefinitions="Auto,*">
                    <Border Grid.Column="0"
                            Background="{StaticResource SurfaceVariantBrush}"
                            BorderBrush="{StaticResource RequestBarBorderBrush}"
                            BorderThickness="0,0,1,0"
                            MinWidth="48">
                        <ScrollViewer x:Name="RawLineNumbersScroller"
                                      VerticalScrollBarVisibility="Hidden"
                                      HorizontalScrollBarVisibility="Disabled">
                            <ItemsControl x:Name="RawLineNumbersControl">
                                <ItemsControl.ItemTemplate>
                                    <DataTemplate>
                                        <TextBlock Text="{Binding}"
                                                   Foreground="{StaticResource TextMutedBrush}"
                                                   FontFamily="{StaticResource MonospaceFontFamily}"
                                                   FontSize="12"
                                                   HorizontalAlignment="Right"
                                                   Padding="8,1,12,1" />
                                    </DataTemplate>
                                </ItemsControl.ItemTemplate>
                            </ItemsControl>
                        </ScrollViewer>
                    </Border>
                    <ScrollViewer x:Name="RawContentScroller"
                                  Grid.Column="1"
                                  HorizontalScrollBarVisibility="Auto"
                                  VerticalScrollBarVisibility="Auto"
                                  ViewChanged="RawContent_ViewChanged"
                                  Padding="12,8">
                        <TextBlock x:Name="RawText"
                                   FontFamily="{StaticResource MonospaceFontFamily}"
                                   FontSize="12"
                                   Foreground="{StaticResource TextPrimaryBrush}"
                                   TextWrapping="NoWrap"
                                   IsTextSelectionEnabled="True" />
                    </ScrollViewer>
                </Grid>
            </Grid>

            <!-- Headers View Panel -->
            <ScrollViewer x:Name="HeadersPanel" Visibility="Collapsed">
                <Grid RowDefinitions="Auto,*" Padding="0">
                    <!-- Headers Table Header -->
                    <Border Grid.Row="0"
                            Background="{StaticResource SurfaceVariantBrush}"
                            BorderBrush="{StaticResource RequestBarBorderBrush}"
                            BorderThickness="0,0,0,1"
                            Padding="0">
                        <Grid ColumnDefinitions="*,2*">
                            <Border Grid.Column="0"
                                    BorderBrush="{StaticResource RequestBarBorderBrush}"
                                    BorderThickness="0,0,1,0"
                                    Padding="16,10">
                                <TextBlock Text="Header"
                                           Foreground="{StaticResource TextMutedBrush}"
                                           FontFamily="{StaticResource AppFontFamilySemiBold}"
                                           FontSize="12" />
                            </Border>
                            <Border Grid.Column="1" Padding="16,10">
                                <TextBlock Text="Value"
                                           Foreground="{StaticResource TextMutedBrush}"
                                           FontFamily="{StaticResource AppFontFamilySemiBold}"
                                           FontSize="12" />
                            </Border>
                        </Grid>
                    </Border>
                    <!-- Headers List -->
                    <ItemsControl Grid.Row="1" x:Name="HeadersListControl">
                        <ItemsControl.ItemTemplate>
                            <DataTemplate>
                                <Border Background="{StaticResource RequestBarBackgroundBrush}"
                                        BorderBrush="{StaticResource RequestBarBorderBrush}"
                                        BorderThickness="0,0,0,1">
                                    <Grid ColumnDefinitions="*,2*">
                                        <Border Grid.Column="0"
                                                BorderBrush="{StaticResource RequestBarBorderBrush}"
                                                BorderThickness="0,0,1,0"
                                                Padding="16,10">
                                            <TextBlock Text="{Binding Key}"
                                                       Foreground="{StaticResource AccentPrimaryBrush}"
                                                       FontFamily="{StaticResource MonospaceFontFamily}"
                                                       FontSize="12"
                                                       IsTextSelectionEnabled="True" />
                                        </Border>
                                        <Border Grid.Column="1" Padding="16,10">
                                            <TextBlock Text="{Binding Value}"
                                                       Foreground="{StaticResource TextPrimaryBrush}"
                                                       FontFamily="{StaticResource MonospaceFontFamily}"
                                                       FontSize="12"
                                                       TextWrapping="Wrap"
                                                       IsTextSelectionEnabled="True" />
                                        </Border>
                                    </Grid>
                                </Border>
                            </DataTemplate>
                        </ItemsControl.ItemTemplate>
                    </ItemsControl>
                </Grid>
            </ScrollViewer>
        </Grid>
    </Grid>
</UserControl>
