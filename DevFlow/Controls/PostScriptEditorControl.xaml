<UserControl x:Class="DevFlow.Controls.PostScriptEditorControl"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:local="using:DevFlow.Controls">

    <Grid Background="{StaticResource SurfaceBrush}">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition Height="*" />
            <RowDefinition Height="Auto" />
        </Grid.RowDefinitions>

        <!-- Header with description -->
        <Border Grid.Row="0"
                Background="{StaticResource RequestBarBackgroundBrush}"
                BorderBrush="{StaticResource RequestBarBorderBrush}"
                BorderThickness="0,0,0,1"
                Padding="16,12">
            <Grid ColumnDefinitions="*,Auto">
                <StackPanel Orientation="Horizontal" Spacing="12">
                    <FontIcon Glyph="{StaticResource IconGlyphCode}"
                              FontSize="16"
                              Foreground="{StaticResource AccentSecondaryBrush}" />
                    <TextBlock Text="Post-request Script"
                               Foreground="{StaticResource TextSecondaryBrush}"
                               FontFamily="{StaticResource AppFontFamilySemiBold}"
                               FontSize="13"
                               VerticalAlignment="Center" />
                </StackPanel>
                <StackPanel Grid.Column="1" Orientation="Horizontal" Spacing="8">
                    <Button x:Name="RunButton"
                            Style="{StaticResource IconButtonStyle}"
                            Click="RunScript_Click"
                            ToolTipService.ToolTip="Run script (test)">
                        <StackPanel Orientation="Horizontal" Spacing="6">
                            <FontIcon Glyph="&#xE768;" FontSize="12" Foreground="{StaticResource SuccessBrush}" />
                            <TextBlock Text="Run" FontSize="12" Foreground="{StaticResource TextSecondaryBrush}" />
                        </StackPanel>
                    </Button>
                    <Button Style="{StaticResource IconButtonStyle}"
                            Click="ClearScript_Click"
                            ToolTipService.ToolTip="Clear script">
                        <FontIcon Glyph="{StaticResource IconGlyphDelete}" FontSize="12" Foreground="{StaticResource TextMutedBrush}" />
                    </Button>
                </StackPanel>
            </Grid>
        </Border>

        <!-- Editor area -->
        <Grid Grid.Row="1">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="Auto" />
                <ColumnDefinition Width="*" />
                <ColumnDefinition Width="Auto" />
            </Grid.ColumnDefinitions>

            <!-- Line numbers -->
            <ScrollViewer x:Name="LineNumbersScroller"
                          Grid.Column="0"
                          Background="{StaticResource TabBarBackgroundBrush}"
                          VerticalScrollMode="Disabled"
                          VerticalScrollBarVisibility="Hidden"
                          HorizontalScrollBarVisibility="Disabled">
                <ItemsControl x:Name="LineNumbersControl"
                              Padding="12,12,8,12"
                              MinWidth="40">
                    <ItemsControl.ItemTemplate>
                        <DataTemplate>
                            <TextBlock Text="{Binding}"
                                       Foreground="{StaticResource TextMutedBrush}"
                                       FontFamily="{StaticResource MonospaceFontFamily}"
                                       FontSize="13"
                                       LineHeight="20"
                                       TextAlignment="Right" />
                        </DataTemplate>
                    </ItemsControl.ItemTemplate>
                </ItemsControl>
            </ScrollViewer>

            <!-- Code editor -->
            <ScrollViewer x:Name="EditorScroller"
                          Grid.Column="1"
                          ViewChanged="Editor_ViewChanged"
                          VerticalScrollBarVisibility="Auto"
                          HorizontalScrollBarVisibility="Auto">
                <TextBox x:Name="CodeEditor"
                         AcceptsReturn="True"
                         TextWrapping="NoWrap"
                         FontFamily="{StaticResource MonospaceFontFamily}"
                         FontSize="13"
                         Padding="12"
                         Background="Transparent"
                         BorderThickness="0"
                         Foreground="{StaticResource AccentSecondaryBrush}"
                         PlaceholderText="// Write your post-request script here..."
                         TextChanged="CodeEditor_TextChanged" />
            </ScrollViewer>

            <!-- Snippets panel -->
            <Border Grid.Column="2"
                    Background="{StaticResource TabBarBackgroundBrush}"
                    BorderBrush="{StaticResource RequestBarBorderBrush}"
                    BorderThickness="1,0,0,0"
                    Width="280">
                <ScrollViewer VerticalScrollBarVisibility="Auto">
                    <StackPanel Padding="12" Spacing="12">
                        <TextBlock Text="Post-request scripts are written in JavaScript, and are run after the response is received."
                                   Foreground="{StaticResource TextMutedBrush}"
                                   FontSize="12"
                                   TextWrapping="Wrap" />

                        <HyperlinkButton Content="Read documentation"
                                         Foreground="{StaticResource AccentPrimaryBrush}"
                                         FontSize="12"
                                         Padding="0" />

                        <TextBlock Text="Snippets"
                                   Foreground="{StaticResource TextSecondaryBrush}"
                                   FontFamily="{StaticResource AppFontFamilySemiBold}"
                                   FontSize="12"
                                   Margin="0,8,0,0" />

                        <!-- Environment snippets -->
                        <Button Style="{StaticResource IconButtonStyle}"
                                Click="InsertSnippet_SetEnv"
                                HorizontalAlignment="Stretch"
                                HorizontalContentAlignment="Left"
                                Padding="8,6">
                            <TextBlock Text="Environment: Set an environment variable"
                                       Foreground="{StaticResource SuccessBrush}"
                                       FontSize="12" />
                        </Button>

                        <!-- Response snippets -->
                        <TextBlock Text="Response"
                                   Foreground="{StaticResource TextSecondaryBrush}"
                                   FontFamily="{StaticResource AppFontFamilySemiBold}"
                                   FontSize="12"
                                   Margin="0,8,0,0" />

                        <Button Style="{StaticResource IconButtonStyle}"
                                Click="InsertSnippet_StatusCode200"
                                HorizontalAlignment="Stretch"
                                HorizontalContentAlignment="Left"
                                Padding="8,6">
                            <TextBlock Text="Response: Status code is 200"
                                       Foreground="{StaticResource SuccessBrush}"
                                       FontSize="12" />
                        </Button>

                        <Button Style="{StaticResource IconButtonStyle}"
                                Click="InsertSnippet_AssertBody"
                                HorizontalAlignment="Stretch"
                                HorizontalContentAlignment="Left"
                                Padding="8,6">
                            <TextBlock Text="Response: Assert property from body"
                                       Foreground="{StaticResource SuccessBrush}"
                                       FontSize="12" />
                        </Button>

                        <!-- Status code snippets -->
                        <TextBlock Text="Status codes"
                                   Foreground="{StaticResource TextSecondaryBrush}"
                                   FontFamily="{StaticResource AppFontFamilySemiBold}"
                                   FontSize="12"
                                   Margin="0,8,0,0" />

                        <Button Style="{StaticResource IconButtonStyle}"
                                Click="InsertSnippet_Status2xx"
                                HorizontalAlignment="Stretch"
                                HorizontalContentAlignment="Left"
                                Padding="8,6">
                            <TextBlock Text="Status code: Status code is 2xx"
                                       Foreground="{StaticResource SuccessBrush}"
                                       FontSize="12" />
                        </Button>

                        <Button Style="{StaticResource IconButtonStyle}"
                                Click="InsertSnippet_Status3xx"
                                HorizontalAlignment="Stretch"
                                HorizontalContentAlignment="Left"
                                Padding="8,6">
                            <TextBlock Text="Status code: Status code is 3xx"
                                       Foreground="{StaticResource SuccessBrush}"
                                       FontSize="12" />
                        </Button>

                        <Button Style="{StaticResource IconButtonStyle}"
                                Click="InsertSnippet_Status4xx"
                                HorizontalAlignment="Stretch"
                                HorizontalContentAlignment="Left"
                                Padding="8,6">
                            <TextBlock Text="Status code: Status code is 4xx"
                                       Foreground="{StaticResource SuccessBrush}"
                                       FontSize="12" />
                        </Button>

                        <Button Style="{StaticResource IconButtonStyle}"
                                Click="InsertSnippet_Status5xx"
                                HorizontalAlignment="Stretch"
                                HorizontalContentAlignment="Left"
                                Padding="8,6">
                            <TextBlock Text="Status code: Status code is 5xx"
                                       Foreground="{StaticResource SuccessBrush}"
                                       FontSize="12" />
                        </Button>
                    </StackPanel>
                </ScrollViewer>
            </Border>
        </Grid>

        <!-- Output/Console panel -->
        <Border Grid.Row="2"
                Background="{StaticResource TabBarBackgroundBrush}"
                BorderBrush="{StaticResource RequestBarBorderBrush}"
                BorderThickness="0,1,0,0"
                MaxHeight="150">
            <Grid RowDefinitions="Auto,*">
                <Border Grid.Row="0"
                        Padding="12,8"
                        BorderBrush="{StaticResource RequestBarBorderBrush}"
                        BorderThickness="0,0,0,1">
                    <Grid ColumnDefinitions="*,Auto">
                        <TextBlock Text="Console Output"
                                   Foreground="{StaticResource TextMutedBrush}"
                                   FontFamily="{StaticResource AppFontFamilyMedium}"
                                   FontSize="11"
                                   VerticalAlignment="Center" />
                        <Button Grid.Column="1"
                                Style="{StaticResource IconButtonStyle}"
                                Click="ClearConsole_Click"
                                ToolTipService.ToolTip="Clear console"
                                Padding="4">
                            <FontIcon Glyph="{StaticResource IconGlyphDelete}" FontSize="10" Foreground="{StaticResource TextMutedBrush}" />
                        </Button>
                    </Grid>
                </Border>
                <ScrollViewer Grid.Row="1"
                              VerticalScrollBarVisibility="Auto"
                              MaxHeight="100">
                    <ItemsControl x:Name="ConsoleOutput" Padding="12,8">
                        <ItemsControl.ItemTemplate>
                            <DataTemplate>
                                <TextBlock Text="{Binding}"
                                           Foreground="{StaticResource TextSecondaryBrush}"
                                           FontFamily="{StaticResource MonospaceFontFamily}"
                                           FontSize="12"
                                           TextWrapping="Wrap"
                                           Margin="0,2" />
                            </DataTemplate>
                        </ItemsControl.ItemTemplate>
                    </ItemsControl>
                </ScrollViewer>
            </Grid>
        </Border>
    </Grid>
</UserControl>
